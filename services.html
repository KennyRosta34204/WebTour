<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D·ªãch V·ª• Du L·ªãch</title>
    <link rel="stylesheet" href="css/services.css">
    <script src="https://kit.fontawesome.com/d63bdcadb6.js" crossorigin="anonymous"></script>
    <!-- Th√™m th∆∞ vi·ªán lazysizes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js" async></script>
    <link rel="stylesheet" href="css/chatbox.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
</head>
<body>
    <!-- Header -->
    <header class="header">
        <!-- N√∫t Home -->
        <a href="index.html" class="home-btn">
            <i class="fa-solid fa-house"></i>
        </a>
        <h1 class="title">Kh√°m Ph√° C√°c Tour Du L·ªãch H·∫•p D·∫´n</h1>
        <p>ƒê·∫∑t tour ngay h√¥m nay ƒë·ªÉ tr·∫£i nghi·ªám nh·ªØng ƒëi·ªÉm ƒë·∫øn tuy·ªát v·ªùi nh·∫•t!</p>
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="T√¨m ki·∫øm tour du l·ªãch..." onkeyup="searchTours()">
            <button onclick="searchTours()">T√¨m ki·∫øm</button>
        </div>
    </header>

    <!-- Danh s√°ch tour -->
    <section class="tour-list" id="tour-list">
        <!-- Danh s√°ch tour s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ƒë·ªông t·ª´ JavaScript -->
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>¬© 2024 KTX. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
    </footer>

    <!-- Th√™m chatbox -->
    <button class="chatbot-toggler">
        <span class="material-symbols-rounded"><img src="img/logo-KTX.png" alt="Chat"></span>
        <span class="material-symbols-outlined">close</span>
    </button>
    <div class="chatbot">
        <header class="chat-header">
            <h2>Chatbot</h2>
            <span class="close-btn material-symbols-outlined">close</span>
        </header>
        <ul class="chatbox">
            <li class="chat incoming">
                <span class="material-symbols-outlined">smart_toy</span>
                <p>Hi there üëã<br>How can I help you today?</p>
            </li>
        </ul>
        <div class="chat-input">
            <textarea placeholder="Enter a message..." spellcheck="false" required></textarea>
            <span id="send-btn" class="material-symbols-rounded">send</span>
        </div>
    </div>

    <script>
        let allTours = [];
        const defaultImage = 'https://placehold.co/300x200?text=·∫¢nh+Tour+Du+L·ªãch';

        // L·∫•y danh s√°ch tour t·ª´ backend
        async function fetchTours() {
            try {
                const response = await fetch("http://localhost:5500/tours");
                if (!response.ok) {
                    throw new Error("L·ªói khi l·∫•y danh s√°ch tour");
                }
                const tours = await response.json();
                allTours = tours;
                console.log("Danh s√°ch tour t·ª´ API:", tours);
                displayTours(tours);
            } catch (error) {
                console.error("L·ªói:", error.message);
                document.getElementById("tour-list").innerHTML = "<p style='text-align: center; color: #555;'>Kh√¥ng th·ªÉ t·∫£i danh s√°ch tour. Vui l√≤ng th·ª≠ l·∫°i sau!</p>";
            }
        }

        // Hi·ªÉn th·ªã danh s√°ch tour
        function displayTours(tours) {
            const tourList = document.getElementById("tour-list");
            if (tours.length === 0) {
                tourList.innerHTML = "<p style='text-align: center; color: #555;'>Kh√¥ng t√¨m th·∫•y tour n√†o ph√π h·ª£p v·ªõi t·ª´ kh√≥a c·ªßa b·∫°n!</p>";
                return;
            }
            tourList.innerHTML = tours.map(tour => `
                <div class="tour-item">
                    <img class="lazyload" data-src="${tour.image || defaultImage}" alt="${tour.title}" onerror="this.onerror=null; this.src='${defaultImage}'; console.error('Kh√¥ng t·∫£i ƒë∆∞·ª£c ·∫£nh: ${tour.image}');">
                    <div class="tour-info">
                        <h2>${tour.title}</h2>
                        <p>${tour.description}</p>
                        <p class="price">Gi√°: ${parseInt(tour.price.replace(/\D/g, '')).toLocaleString('vi-VN')} VNƒê</p>
                        <a href="tour-detail.html?id=${tour.id}" class="btn">Xem chi ti·∫øt</a>
                    </div>
                </div>
            `).join("");
        }

        // T√¨m ki·∫øm tour
        function searchTours() {
            const searchInput = document.getElementById("search-input").value.toLowerCase();
            const filteredTours = allTours.filter(tour => 
                tour.title.toLowerCase().includes(searchInput) || 
                tour.description.toLowerCase().includes(searchInput)
            );
            displayTours(filteredTours);
        }

        // G·ªçi h√†m fetchTours khi trang ƒë∆∞·ª£c t·∫£i
        fetchTours();
    </script>
    <script src="script.js"></script> <!-- Di chuy·ªÉn xu·ªëng cu·ªëi body -->
</body>
</html>